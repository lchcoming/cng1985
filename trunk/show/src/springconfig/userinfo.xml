<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">

	<!--
		<bean id="helloAction" class="com.ada.action.HelloAction"
		abstract="false" lazy-init="default" autowire="default"
		dependency-check="default"> </bean> <bean id="flowAction"
		class="com.ada.action.FlowAction" abstract="false" lazy-init="default"
		autowire="default" dependency-check="default"> <property
		name="hellowork" ref="hello"></property> </bean>
	-->
	<bean id="propertyConfigurer"
		class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
		<property name="locations">
			<list>
				<value>classpath:conf/jdbc.properties
				</value>
			</list>
		</property>
	</bean>
	<!-- 数据源配置  -->
	<bean id="dataSource" class="com.mchange.v2.c3p0.ComboPooledDataSource" destroy-method="close">
		<property name="driverClass">
		   <value>${c3p0.driverClass}</value>
		</property>
		<property name="jdbcUrl">
		   <value>${c3p0.jdbcUrl}</value>
		</property>
		<property name="user">
		   <value>${c3p0.user}</value>
		</property>
		<property name="password">
		   <value>${c3p0.password}</value>
		</property>
		<property name="minPoolSize">
		   <value>${c3p0.minPoolSize}</value>
		</property>
		<property name="maxPoolSize">
		   <value>${c3p0.maxPoolSize}</value>
		</property>
		<property name="initialPoolSize">
		   <value>${c3p0.initialPoolSize}</value>
		</property>
		<property name="maxIdleTime">
		   <value>${c3p0.maxIdleTime}</value>
		</property>
		<property name="acquireIncrement">
		   <value>${c3p0.acquireIncrement}</value>
		</property>
		<property name="maxStatements">
		   <value>${c3p0.maxStatements}</value>
		</property>
		<property name="idleConnectionTestPeriod">
		   <value>${c3p0.idleConnectionTestPeriod}</value>
		</property>
		<property name="acquireRetryAttempts">
			<value>${c3p0.acquireRetryAttempts}</value>
		</property>
		<property name="breakAfterAcquireFailure">
			<value>${c3p0.breakAfterAcquireFailure}</value>
		</property>
		<property name="testConnectionOnCheckout">
			<value>${c3p0.testConnectionOnCheckout}</value>
		</property>
	</bean>
	

     <!-- 事务配置  -->
     <bean id="transactionManager" class="org.springframework.jdbc.datasource.DataSourceTransactionManager">  
	     <property name="dataSource" ref="dataSource" />  
	 </bean>  
 
     <!-- 
        <tx:annotation-driven transaction-manager="transactionManager" />   
     --> 

	
    <!-- 配置Hibernate中的SessionFactory -->
	<bean id="sessionFactory" class="org.springframework.orm.hibernate3.LocalSessionFactoryBean">
		<property name="dataSource">
			<ref bean="dataSource" />
		</property>
		<property name="mappingDirectoryLocations">
			<list>
			<value>classpath:com/ada/entity/</value> 
			</list> 
		</property>
	</bean>
	
	<bean id="transactionProxy" class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean" abstract="true">
	
	  <property name="transactionManager">
        <ref bean="transactionManager"/>	  
	  </property>
	  <property name="transactionAttributes">
	 
	    <props>
	      
	      <prop key="add*">PROPAGATION_REQUIRED</prop>
	      <prop key="pre*">PROPAGATION_REQUIRED</prop>
	      <prop key="delete*">PROPAGATION_REQUIRED</prop>
	      <prop key="modify*">PROPAGATION_REQUIRED</prop>
	      <prop key="edit*">PROPAGATION_REQUIRED</prop>
	      <prop key="update*">PROPAGATION_REQUIRED</prop>
	      <prop key="find*">PROPAGATION_REQUIRED,readOnly</prop>
	      <prop key="release*">PROPAGATION_REQUIRED</prop>
	      <prop key="get*">PROPAGATION_REQUIRED,readOnly</prop>
	    </props>
	  </property>
	</bean>
	<bean id="UserInfoAction" class="com.work.userinfo.action.UserInfoAction"
		abstract="false" lazy-init="default" autowire="default"
		dependency-check="default" scope="prototype">
		<property name="baseDAO" ref="UserInfoDAO"></property>
	</bean>
	<bean id="UserInfoDAOw" class="com.work.userinfo.dao.UserInfoDAOImpl"
		abstract="false" lazy-init="default" autowire="default"
		dependency-check="default" scope="prototype">
		<property name="sessionFactory" ref="sessionFactory"></property>
	</bean>
	<bean id="UserInfoDAO" parent="transactionProxy">
		<property name="target" ref="BaseDAOs"></property>
	</bean>
		<bean id="BaseDAOs" class="com.ada.dao.impl.BaseDAOImpl" abstract="false"
		lazy-init="default" autowire="default" dependency-check="default"
		scope="prototype">
		<property name="sessionFactory" ref="sessionFactory"></property>
	</bean>
</beans>
